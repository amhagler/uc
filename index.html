<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unit Planner with Holidays</title>
    <style>
        body {
            font-family: Garamond, serif;
            background-color: #ececec;
            color: #2D68C4;
            padding: 20px;
            margin: 0;
            line-height: 1;
            font-size: 11px;
        }
        h1, h2 {
            color: #2D68C4;
            text-align: center;
        }
        form {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
        }
        .block-selection {
            width: 100%;
            text-align: center;
        }
        label {
            display: block;
            margin-bottom: 5px;
            text-align: center;
        }
        input, select, button {
            padding: 12px;
            font-size: 16px;
            margin-bottom: 10px;
            border: none;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        button {
            background-color: #2D68C4;
            color: white;
            cursor: pointer;
        }
        button:hover {
            background-color: #1E4F8E;
        }
        table {
            width: 100%;
            max-width: 650px;
            margin: 0 auto;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #000;
            padding: 8px;
            text-align: center;
            font-size: 11px;
        }
        th {
            background-color: #2D68C4;
            color: white;
        }
        .blue-week {
            background-color: #B3CDE0;
        }
        .gold-week {
            background-color: #FBE6C5;
        }
        .holiday-row {
            background-color: #D3D3D3;
            color: black;
        }
        .checkbox-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }
        .block-checkbox {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .block-checkbox input {
            width: 20px;
            height: 20px;
        }
        .copy-button-container {
            text-align: center;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>Unit Planner with Holidays</h1>

    <form id="calendar-form">
        <div>
            <label for="start-date">Start Date:</label>
            <input type="date" id="start-date" name="start-date" required>
        </div>
        <div>
            <label for="end-class-count">End by:</label>
            <select id="end-option" name="end-option" onchange="toggleEndInput()">
                <option value="date">End Date</option>
                <option value="class-count">Number of Classes</option>
            </select>
        </div>
        <div id="end-date-container">
            <label for="end-date">End Date:</label>
            <input type="date" id="end-date" name="end-date">
        </div>
        <div id="class-count-container" style="display: none;">
            <label for="class-count">Number of Classes:</label>
            <input type="number" id="class-count" name="class-count" min="1">
        </div>
        <div>
            <label for="holiday-dates">Holiday Dates:</label>
            <input type="date" id="holiday-dates">
            <button type="button" onclick="addHoliday()">Add Holiday</button>
            <ul id="holiday-list"></ul>
        </div>
        <div>
            <label for="start-week">Starting Week:</label>
            <select id="start-week" name="start-week" required>
                <option value="blue">Blue Week</option>
                <option value="gold">Gold Week</option>
            </select>
        </div>
        <div class="block-selection">
            <label>Select Blocks:</label>
            <div class="checkbox-container">
                <label class="block-checkbox"><input type="checkbox" id="block-A" name="block" value="A"> A Block</label>
                <label class="block-checkbox"><input type="checkbox" id="block-B" name="block" value="B"> B Block</label>
                <label class="block-checkbox"><input type="checkbox" id="block-C" name="block" value="C"> C Block</label>
                <label class="block-checkbox"><input type="checkbox" id="block-D" name="block" value="D"> D Block</label>
                <label class="block-checkbox"><input type="checkbox" id="block-E" name="block" value="E"> E Block</label>
                <label class="block-checkbox"><input type="checkbox" id="block-F" name="block" value="F"> F Block</label>
                <label class="block-checkbox"><input type="checkbox" id="block-G" name="block" value="G"> G Block</label>
            </div>
        </div>
        <button type="button" onclick="generateUnitCalendar()">Generate Unit Calendar</button>
    </form>

    <table id="unit-calendar">
        <thead>
            <tr>
                <th>Class Number</th>
                <th>Day/Date</th>
                <th>Topic</th>
                <th>In-class</th>
                <th>Homework</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
    
    <div class="copy-button-container">
        <button id="copy-button" style="display: none;" onclick="copyTable()">Copy Table</button>
    </div>

    <script>
        let holidays = [];

        function toggleEndInput() {
            const endOption = document.getElementById('end-option').value;
            const endDateContainer = document.getElementById('end-date-container');
            const classCountContainer = document.getElementById('class-count-container');

            if (endOption === 'date') {
                endDateContainer.style.display = 'block';
                classCountContainer.style.display = 'none';
                document.getElementById('end-date').required = true;
                document.getElementById('class-count').required = false;
            } else {
                endDateContainer.style.display = 'none';
                classCountContainer.style.display = 'block';
                document.getElementById('end-date').required = false;
                document.getElementById('class-count').required = true;
            }
        }

        function addHoliday() {
            const holidayInput = document.getElementById('holiday-dates').value;
            if (holidayInput) {
                holidays.push(holidayInput);
                const listItem = document.createElement('li');
                listItem.textContent = holidayInput;
                document.getElementById('holiday-list').appendChild(listItem);
                document.getElementById('holiday-dates').value = '';
            }
        }

        function formatDateToString(date) {
            const year = date.getUTCFullYear();
            const month = String(date.getUTCMonth() + 1).padStart(2, '0');
            const day = String(date.getUTCDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        function parseDateFromString(dateStr) {
            const [year, month, day] = dateStr.split('-').map(Number);
            return new Date(Date.UTC(year, month - 1, day));
        }

        function generateUnitCalendar() {
            const startDateInput = document.getElementById('start-date').value;
            const endOption = document.getElementById('end-option').value;
            let endDateInput = document.getElementById('end-date').value;
            let classCountInput = parseInt(document.getElementById('class-count').value);
            const startWeek = document.getElementById('start-week').value;

            if (!startDateInput) {
                alert('Please enter a start date.');
                return;
            }

            const startDate = parseDateFromString(startDateInput);

            if (endOption === 'date' && !endDateInput) {
                alert('Please enter an end date.');
                return;
            }

            if (endOption === 'class-count' && !classCountInput) {
                alert('Please enter the number of classes.');
                return;
            }

            const endDate = endOption === 'date' ? parseDateFromString(endDateInput) : null;

            const selectedBlocks = Array.from(document.querySelectorAll('input[name="block"]:checked')).map(checkbox => checkbox.value);
            if (selectedBlocks.length === 0) {
                alert('Please select at least one block.');
                return;
            }

            const calendarTable = document.getElementById('unit-calendar').getElementsByTagName('tbody')[0];
            calendarTable.innerHTML = ''; // Clear existing calendar data

            const weekDays = ['M', 'T', 'W', 'Th', 'F'];
            const blueWeek = {
                "monday": ["A", "B", "C", "D", "E"],
                "tuesday": ["F", "G", "A", "B", "C"],
                "wednesday": ["D", "E", "F", "G", "A"],
                "thursday": ["B", "C", "D", "E", "F"],
                "friday": ["G", "A", "B", "C", "D"]
            };
            const goldWeek = {
                "monday": ["E", "F", "G", "A", "B"],
                "tuesday": ["C", "D", "E", "F", "G"],
                "wednesday": ["A", "B", "C", "D", "E"],
                "thursday": ["F", "G", "A", "B", "C"],
                "friday": ["D", "E", "F", "G"]
            };

            const scheduleData = { blue: blueWeek, gold: goldWeek };
            let currentWeek = startWeek;
            let currentDate = startDate;
            let dateEntries = [];

            // Step 1: Determine the schedule for each block and assign class numbers
            let classNumbers = {}; // Stores class numbers for each block
            selectedBlocks.forEach(block => {
                classNumbers[block] = 1; // Initialize class number for each block
            });

            while ((endOption === 'date' && currentDate <= endDate) || 
                   (endOption === 'class-count' && Object.values(classNumbers).some(num => num <= classCountInput))) {
                const dayOfWeek = currentDate.getUTCDay();
                const formattedDate = formatDateToString(currentDate);

                if (holidays.includes(formattedDate)) {
                    // If a holiday occurs, insert it and reset the last class number to prevent merging
                    dateEntries.push({
                        type: 'holiday',
                        date: formattedDate,
                        displayDate: `${weekDays[dayOfWeek - 1]} ${currentDate.getUTCMonth() + 1}/${currentDate.getUTCDate()}`,
                    });
                    currentDate.setUTCDate(currentDate.getUTCDate() + 1);
                    continue;
                }

                if (dayOfWeek === 0 || dayOfWeek === 6) { // Skip weekends
                    currentDate.setUTCDate(currentDate.getUTCDate() + 1);
                    continue;
                }

                const weekDayName = Object.keys(scheduleData[currentWeek])[dayOfWeek - 1];
                const scheduleForDay = scheduleData[currentWeek][weekDayName];
                const dateStr = `${weekDays[dayOfWeek - 1]} ${currentDate.getUTCMonth() + 1}/${currentDate.getUTCDate()}`;

                scheduleForDay.forEach(block => {
                    if (selectedBlocks.includes(block) && classNumbers[block] <= classCountInput) {
                        dateEntries.push({
                            type: 'class',
                            classNum: classNumbers[block],
                            block: block,
                            displayDate: dateStr,
                            week: currentWeek
                        });
                        classNumbers[block]++;
                    }
                });

                if (dayOfWeek === 5) { // After Friday, switch weeks
                    currentWeek = currentWeek === 'blue' ? 'gold' : 'blue';
                }

                currentDate.setUTCDate(currentDate.getUTCDate() + 1);
            }

            // Step 2: Merge cells in the "Class Number" column and the corresponding rows in "Topic," "In-Class," and "Homework" columns
            let lastClassNumber = null;
            let lastRow = null;

            dateEntries.forEach((entry, index) => {
                const row = calendarTable.insertRow();
                
                // Apply color coding for blue and gold weeks
                if (entry.week === 'blue') {
                    row.className = 'blue-week';
                } else if (entry.week === 'gold') {
                    row.className = 'gold-week';
                }

                if (entry.type === 'holiday') {
                    row.className = 'holiday-row';
                    const cell1 = row.insertCell(0);
                    cell1.colSpan = 5;
                    cell1.textContent = `${entry.displayDate} (Holiday)`;
                    lastClassNumber = null; // Prevent merging with subsequent rows
                    return;
                }

                if (entry.classNum === lastClassNumber) {
                    lastRow.cells[0].rowSpan = (lastRow.cells[0].rowSpan || 1) + 1;
                    lastRow.cells[2].rowSpan = (lastRow.cells[2].rowSpan || 1) + 1;
                    lastRow.cells[3].rowSpan = (lastRow.cells[3].rowSpan || 1) + 1;
                    lastRow.cells[4].rowSpan = (lastRow.cells[4].rowSpan || 1) + 1;
                    row.insertCell(0).style.display = 'none'; // Hide the merged cell
                } else {
                    lastClassNumber = entry.classNum;
                    lastRow = row;
                    const cell1 = row.insertCell(0);
                    cell1.textContent = entry.classNum;
                }

                const cell2 = row.insertCell(1);
                cell2.textContent = `${entry.displayDate} (${entry.block})`;
                const cell3 = row.insertCell(2);
                cell3.textContent = ''; // Topic
                const cell4 = row.insertCell(3);
                cell4.textContent = ''; // In-Class
                const cell5 = row.insertCell(4);
                cell5.textContent = ''; // Homework

                // Merge cells for "Topic", "In-Class", and "Homework"
                if (index > 0 && entry.classNum === dateEntries[index - 1].classNum && dateEntries[index - 1].type !== 'holiday') {
                    cell3.style.display = 'none';
                    cell4.style.display = 'none';
                    cell5.style.display = 'none';
                }
            });

            // Show the copy button
            document.getElementById('copy-button').style.display = 'block';
        }

        function copyTable() {
            const table = document.getElementById('unit-calendar');
            const range = document.createRange();
            const selection = window.getSelection();

            range.selectNodeContents(table);
            selection.removeAllRanges();
            selection.addRange(range);

            try {
                document.execCommand('copy');
                alert('Table copied to clipboard');
            } catch (err) {
                alert('Failed to copy table');
            }
        }
    </script>
</body>
</html>

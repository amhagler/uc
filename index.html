<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unit Planner with Holidays</title>
    <style>
        body {
            font-family: Garamond, serif;
            background-color: #ececec;
            color: #2D68C4;
            padding: 20px;
            margin: 0;
            line-height: 1;
            font-size: 11px;
        }
        h1, h2 {
            color: #2D68C4;
            text-align: center;
        }
        form {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
        }
        .block-selection {
            width: 100%;
            text-align: center;
        }
        label {
            display: block;
            margin-bottom: 5px;
            text-align: center;
        }
        input, select, button {
            padding: 10px;
            font-size: 14px;
            margin-bottom: 10px;
        }
        table {
            width: 100%;
            max-width: 650px;
            margin: 0 auto;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #000;
            padding: 8px;
            text-align: center;
            font-size: 11px;
        }
        th {
            background-color: #2D68C4;
            color: white;
        }
        .blue-week {
            background-color: #B3CDE0;
        }
        .gold-week {
            background-color: #FBE6C5;
        }
        .holiday-row {
            background-color: #D3D3D3;
            color: black;
        }
        .checkbox-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }
        .block-checkbox {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .copy-button-container {
            text-align: center;
            margin-top: 20px;
        }
        #popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 400px;
            background-color: white;
            border: 1px solid #000;
            padding: 20px;
            z-index: 1000;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
        }
        #popup h3 {
            text-align: center;
        }
        #popup p {
            font-size: 12px;
            margin: 10px 0;
        }
        #close-popup {
            display: block;
            margin: 20px auto 0;
            padding: 10px;
            background-color: #2D68C4;
            color: white;
            border: none;
            cursor: pointer;
        }
        #popup-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 500;
        }
    </style>
</head>
<body>
    <h1>Unit Planner with Holidays</h1>
    
    <div class="popup-button-container" style="text-align: center;">
        <button onclick="showPopup()">Instructions and Disclaimers</button>
    </div>

    <form id="calendar-form">
        <div>
            <label for="start-date">Start Date:</label>
            <input type="date" id="start-date" name="start-date" required>
        </div>
        <div>
            <label for="end-class-count">End by:</label>
            <select id="end-option" name="end-option" onchange="toggleEndInput()">
                <option value="date">End Date</option>
                <option value="class-count">Number of Classes</option>
            </select>
        </div>
        <div id="end-date-container">
            <label for="end-date">End Date:</label>
            <input type="date" id="end-date" name="end-date">
        </div>
        <div id="class-count-container" style="display: none;">
            <label for="class-count">Number of Classes:</label>
            <input type="number" id="class-count" name="class-count" min="1">
        </div>
        <div>
            <label for="holiday-dates">Holiday Dates:</label>
            <input type="date" id="holiday-dates">
            <button type="button" onclick="addHoliday()">Add Holiday</button>
            <ul id="holiday-list"></ul>
        </div>
        <div>
            <label for="start-week">Starting Week:</label>
            <select id="start-week" name="start-week" required>
                <option value="blue">Blue Week</option>
                <option value="gold">Gold Week</option>
            </select>
        </div>
        <div class="block-selection">
            <label>Select Blocks:</label>
            <div class="checkbox-container">
                <label class="block-checkbox"><input type="checkbox" id="block-A" name="block" value="A"> A Block</label>
                <label class="block-checkbox"><input type="checkbox" id="block-B" name="block" value="B"> B Block</label>
                <label class="block-checkbox"><input type="checkbox" id="block-C" name="block" value="C"> C Block</label>
                <label class="block-checkbox"><input type="checkbox" id="block-D" name="block" value="D"> D Block</label>
                <label class="block-checkbox"><input type="checkbox" id="block-E" name="block" value="E"> E Block</label>
                <label class="block-checkbox"><input type="checkbox" id="block-F" name="block" value="F"> F Block</label>
                <label class="block-checkbox"><input type="checkbox" id="block-G" name="block" value="G"> G Block</label>
            </div>
        </div>
        <button type="button" onclick="generateUnitCalendar()">Generate Unit Calendar</button>
    </form>

    <table id="unit-calendar">
        <thead>
            <tr>
                <th>Class Number</th>
                <th>Day/Date</th>
                <th>Topic</th>
                <th>In-class</th>
                <th>Homework</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
    
    <div class="copy-button-container">
        <button id="copy-button" style="display: none;" onclick="copyTable()">Copy Table</button>
    </div>

    <div id="popup-overlay"></div>

    <div id="popup">
        <h3>Instructions and Disclaimers</h3>
        <p>This unit calendar generator is designed for Geffen Academy's schedule. Be aware of the following bugs, which require some care:</p>
        <p>1. When holidays are entered, sometimes the fields adjacent to the holidays generate extra dates. These can just be deleted. I don't know why this is happening.</p>
        <p>2. If you are using the "Number of Classes" function, always add more classes than you think you need to make sure the calendar generates all possible meetings for the classes.</p>
        <p>3. Always double check against Geffen's master calendar. This is designed to be a time saving tool, but the program is only as smart as its programmer. Be prepared to shift dates around as necessary.</p>
        <button id="close-popup" onclick="closePopup()">Close</button>
    </div>

    <script>
        let holidays = [];

        function toggleEndInput() {
            const endOption = document.getElementById('end-option').value;
            const endDateContainer = document.getElementById('end-date-container');
            const classCountContainer = document.getElementById('class-count-container');

            if (endOption === 'date') {
                endDateContainer.style.display = 'block';
                classCountContainer.style.display = 'none';
                document.getElementById('end-date').required = true;
                document.getElementById('class-count').required = false;
            } else {
                endDateContainer.style.display = 'none';
                classCountContainer.style.display = 'block';
                document.getElementById('end-date').required = false;
                document.getElementById('class-count').required = true;
            }
        }

        function addHoliday() {
            const holidayInput = document.getElementById('holiday-dates').value;
            if (holidayInput) {
                holidays.push(holidayInput);
                const listItem = document.createElement('li');
                listItem.textContent = holidayInput;
                document.getElementById('holiday-list').appendChild(listItem);
                document.getElementById('holiday-dates').value = '';
            }
        }

        function formatDateToString(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        function parseDateFromString(dateStr) {
            const [year, month, day] = dateStr.split('-').map(Number);
            return new Date(year, month - 1, day);
        }

        function generateUnitCalendar() {
            const startDateInput = document.getElementById('start-date').value;
            const endOption = document.getElementById('end-option').value;
            let endDateInput = document.getElementById('end-date').value;
            let classCountInput = parseInt(document.getElementById('class-count').value);
            const startWeek = document.getElementById('start-week').value;

            if (!startDateInput) {
                alert('Please enter a start date.');
                return;
            }

            const startDate = parseDateFromString(startDateInput);

            if (endOption === 'date' && !endDateInput) {
                alert('Please enter an end date.');
                return;
            }

            if (endOption === 'class-count' && !classCountInput) {
                alert('Please enter the number of classes.');
                return;
            }

            const endDate = endOption === 'date' ? parseDateFromString(endDateInput) : null;

            const selectedBlocks = Array.from(document.querySelectorAll('input[name="block"]:checked')).map(checkbox => checkbox.value);
            if (selectedBlocks.length === 0) {
                alert('Please select at least one block.');
                return;
            }

            const calendarTable = document.getElementById('unit-calendar').getElementsByTagName('tbody')[0];
            calendarTable.innerHTML = ''; // Clear existing calendar data

            const weekDays = ['M', 'T', 'W', 'Th', 'F'];
            const blueWeek = {
                "monday": ["A", "B", "C", "D", "E"],
                "tuesday": ["F", "G", "A", "B", "C"],
                "wednesday": ["D", "E", "F", "G", "A"],
                "thursday": ["B", "C", "D", "E", "F"],
                "friday": ["G", "A", "B", "C", "D"]
            };
            const goldWeek = {
                "monday": ["E", "F", "G", "A", "B"],
                "tuesday": ["C", "D", "E", "F", "G"],
                "wednesday": ["A", "B", "C", "D", "E"],
                "thursday": ["F", "G", "A", "B", "C"],
                "friday": ["D", "E", "F", "G"]
            };

            const scheduleData = { blue: blueWeek, gold: goldWeek };
            let currentWeek = startWeek;
            let currentDate = startDate;
            let lessonSchedule = {};
            let classNumber = 1;
            let dateEntries = [];

            let totalClassesGenerated = 0;

            while ((endOption === 'date' && currentDate <= endDate) || 
                   (endOption === 'class-count' && totalClassesGenerated < classCountInput * selectedBlocks.length)) {
                const dayOfWeek = currentDate.getDay();
                const formattedDate = formatDateToString(currentDate);

                // Add holidays to the dateEntries array
                if (holidays.includes(formattedDate)) {
                    dateEntries.push({
                        type: 'holiday',
                        date: formattedDate,
                        displayDate: `${weekDays[dayOfWeek - 1]} ${currentDate.getMonth() + 1}/${currentDate.getDate()}`,
                    });
                    currentDate.setDate(currentDate.getDate() + 1);
                    continue;
                }

                if (dayOfWeek === 0 || dayOfWeek === 6) { // Skip weekends
                    currentDate.setDate(currentDate.getDate() + 1);
                    continue;
                }

                const weekDayName = Object.keys(scheduleData[currentWeek])[dayOfWeek - 1];
                const scheduleForDay = scheduleData[currentWeek][weekDayName];
                const dateStr = `${weekDays[dayOfWeek - 1]} ${currentDate.getMonth() + 1}/${currentDate.getDate()}`;

                scheduleForDay.forEach(block => {
                    if (selectedBlocks.includes(block) && 
                        ((endOption === 'date' && currentDate <= endDate) || 
                         (endOption === 'class-count' && totalClassesGenerated < classCountInput * selectedBlocks.length))) {
                        
                        if (!lessonSchedule[block]) {
                            lessonSchedule[block] = [];
                        }

                        if (!lessonSchedule[block][classNumber]) {
                            lessonSchedule[block][classNumber] = [];
                        }

                        lessonSchedule[block][classNumber].push({ date: formattedDate, displayDate: dateStr, week: currentWeek });
                        totalClassesGenerated++;
                    }
                });

                if (dayOfWeek === 5) { // After Friday, switch weeks
                    currentWeek = currentWeek === 'blue' ? 'gold' : 'blue';
                }

                currentDate.setDate(currentDate.getDate() + 1);

                // If all blocks have had this class number, increment class number
                const allBlocksCompleted = selectedBlocks.every(block => lessonSchedule[block] && lessonSchedule[block][classNumber]);
                if (allBlocksCompleted) {
                    classNumber++;
                }

                if (endOption === 'class-count' && totalClassesGenerated >= classCountInput * selectedBlocks.length) {
                    break;
                }
            }

            // Add the holidays and class dates to dateEntries
            Object.keys(lessonSchedule).forEach(block => {
                Object.keys(lessonSchedule[block]).forEach(classNum => {
                    dateEntries.push({
                        type: 'class',
                        classNum,
                        block,
                        dates: lessonSchedule[block][classNum]
                    });
                });
            });

            // Sort the dateEntries array by date
            dateEntries.sort((a, b) => parseDateFromString(a.dates ? a.dates[0].date : a.date) - parseDateFromString(b.dates ? b.dates[0].date : b.date));

            // Group by class number
            let groupedClasses = {};
            dateEntries.forEach(entry => {
                if (entry.type === 'class') {
                    if (!groupedClasses[entry.classNum]) {
                        groupedClasses[entry.classNum] = [];
                    }
                    groupedClasses[entry.classNum].push(...entry.dates.map(date => `${date.displayDate} (${entry.block})`));
                }
            });

            // Generate the rows in the table
            dateEntries.forEach(entry => {
                const row = calendarTable.insertRow();
                
                if (entry.type === 'holiday') {
                    row.className = 'holiday-row';
                    const cell1 = row.insertCell(0);
                    const cell2 = row.insertCell(1);
                    const cell3 = row.insertCell(2);
                    const cell4 = row.insertCell(3);
                    const cell5 = row.insertCell(4);

                    cell1.textContent = '-';
                    cell2.textContent = `${entry.displayDate} (Holiday)`;
                    cell3.textContent = 'Holiday';
                    cell4.textContent = '';
                    cell5.textContent = '';
                } else if (entry.type === 'class' && groupedClasses[entry.classNum]) {
                    const rowClass = entry.dates[0].week === 'blue' ? 'blue-week' : 'gold-week';
                    row.className = rowClass;

                    const cell1 = row.insertCell(0);
                    const cell2 = row.insertCell(1);
                    const cell3 = row.insertCell(2);
                    const cell4 = row.insertCell(3);
                    const cell5 = row.insertCell(4);

                    cell1.textContent = entry.classNum;
                    cell2.innerHTML = groupedClasses[entry.classNum].join('<br>');
                    cell3.textContent = '';
                    cell4.textContent = '';
                    cell5.textContent = '';

                    // Remove the grouped class to avoid duplication
                    delete groupedClasses[entry.classNum];
                }
            });

            // Show the copy button
            document.getElementById('copy-button').style.display = 'block';
        }

        function copyTable() {
            const table = document.getElementById('unit-calendar');
            const range = document.createRange();
            const selection = window.getSelection();

            range.selectNodeContents(table);
            selection.removeAllRanges();
            selection.addRange(range);

            try {
                document.execCommand('copy');
                alert('Table copied to clipboard');
            } catch (err) {
                alert('Failed to copy table');
            }
        }

        function showPopup() {
            document.getElementById('popup-overlay').style.display = 'block';
            document.getElementById('popup').style.display = 'block';
        }

        function closePopup() {
            document.getElementById('popup-overlay').style.display = 'none';
            document.getElementById('popup').style.display = 'none';
        }
    </script>
</body>
</html>
